<?php

namespace App\Http\Controllers;

use App\Models\Exploitation;
use Illuminate\Http\Request;


class ExploitationController extends Controller
{
    public function nuevo(){
        return view('administrador.Evaluacion.create');
    }

    public function read(Request $request){
        $exploitations = Exploitation::all('nivel','min','max','id');
        $datos = compact('exploitations',$exploitations);
        $vista = view('administrador.Evaluacion.read', $datos);
        if($request->ajax()){

            return view('administrador.Evaluacion.ajax.tabla', $datos);
        }
        return $vista;
    }

    public function edit(Exploitation $exploitation){
        $exploitations = Exploitation::all(['id','min','max','nivel']);
        return view('administrador.Evaluacion.edit',compact('exploitation'))
            ->with(compact('exploitations',$exploitations));
    }

    public function update(Request $request, $id){
        $this->validate($request, [
            'nivel' => 'required',
            'min' => 'required',
            'max' => 'required'
        ],[
            'nivel.required' => 'Debe poner el campo nivel',
            'min.required' => 'Debe poner un valor minimo',
            'max.required' => 'Debe poner un valor maximo'
        ]);

        $Exploitation = Exploitation::findOrFail($id);
        $Exploitation -> nivel = $request -> nivel;
        $Exploitation -> min = $request -> min;
        $Exploitation -> max = $request -> max;
        try {
            $Exploitation -> save();
        } catch (\Exception $e) {
            return redirect()->back()->with('message', 'La operaci√≥n ha fallado, por favor, contacte al administrador.');
        }

        return view('administrador.Evaluacion.ajax.exito');
    }
}
